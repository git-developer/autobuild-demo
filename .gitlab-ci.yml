variables:
  BUILD_CONTEXT:      image
  IMAGE_PLATFORMS:    linux/amd64,linux/i386,linux/arm/v7,linux/arm64/v8

include:
  remote: "https://github.com/git-developer/docker-support/raw/develop/gitlab-ci/docker-support.yml"

stages:
  - prepare
  - analyze
  - build

Prepare Container Image:
  extends: .docker_support:.build_bare_image
  stage: prepare

Collect Tags:
  extends: .docker_support:.collect_tags
  stage: prepare

Collect Labels:
  extends: .docker_support:.collect_labels
  stage: prepare

Collect Additional Tags:
  stage: analyze
  image: "alpine"
  dependencies:
  - Collect Tags
  artifacts:
    paths:
    - tags
  script:
  - echo >tags/demo "${CI_PROJECT_PATH}:demo"

Build Container Image:
  extends: .docker_support:.build_full_image
  stage: build
